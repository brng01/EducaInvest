-- Create game_questions table
CREATE TABLE IF NOT EXISTS public.game_questions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    game_type TEXT NOT NULL CHECK (game_type IN ('consultor', 'termo')),
    content JSONB NOT NULL,
    difficulty TEXT DEFAULT 'easy',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Create empire_items table
CREATE TABLE IF NOT EXISTS public.empire_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('active', 'passive')),
    base_cost NUMERIC NOT NULL,
    base_income NUMERIC NOT NULL,
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Enable RLS
ALTER TABLE public.game_questions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.empire_items ENABLE ROW LEVEL SECURITY;

-- Allow read access to everyone
DO $$ 
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE tablename = 'game_questions' AND policyname = 'Enable read access for all users') THEN
        CREATE POLICY "Enable read access for all users" ON public.game_questions FOR SELECT USING (true);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE tablename = 'empire_items' AND policyname = 'Enable read access for all users') THEN
        CREATE POLICY "Enable read access for all users" ON public.empire_items FOR SELECT USING (true);
    END IF;
END $$;

-- Clean existing data to avoid duplicates if re-running
TRUNCATE TABLE public.game_questions RESTART IDENTITY;
TRUNCATE TABLE public.empire_items RESTART IDENTITY;

-- Seed Data: O Consultor (15 Scenarios with Icons)
INSERT INTO public.game_questions (game_type, content, difficulty) VALUES
('consultor', '{"text": "Investimento com retorno garantido de 10% ao m√™s.", "type": "bad", "icon": "üöÄ", "explanation": "Golpe! Retornos garantidos muito acima do mercado (como 1% a.m.) geralmente s√£o pir√¢mides financeiras."}', 'easy'),
('consultor', '{"text": "Empr√©stimo pessoal com juros de 8% ao m√™s para comprar roupas.", "type": "bad", "icon": "üí∏", "explanation": "Juros abusivos! 8% ao m√™s vira mais de 150% ao ano. Nunca tome d√≠vida cara para consumo."}', 'easy'),
('consultor', '{"text": "Reserva de Emerg√™ncia no Tesouro Selic.", "type": "good", "icon": "üõ°Ô∏è", "explanation": "√ìtima escolha! O Tesouro Selic √© seguro e tem liquidez di√°ria, ideal para emerg√™ncias."}', 'easy'),
('consultor', '{"text": "Vender todas as a√ß√µes porque o mercado caiu hoje.", "type": "bad", "icon": "üìâ", "explanation": "P√¢nico! Vender na baixa consolida o preju√≠zo. O ideal √© analisar os fundamentos e pensar no longo prazo."}', 'easy'),
('consultor', '{"text": "Aporte mensal em fundos imobili√°rios para gerar renda passiva.", "type": "good", "icon": "üè¢", "explanation": "Excelente estrat√©gia! A const√¢ncia nos aportes e o reinvestimento dos dividendos criam uma bola de neve."}', 'easy'),
('consultor', '{"text": "Financiar um carro de luxo em 60x sem entrada.", "type": "bad", "icon": "üöó", "explanation": "Cuidado! O custo total ser√° muito maior que o valor do carro, e o ve√≠culo desvaloriza r√°pido."}', 'medium'),
('consultor', '{"text": "Diversificar a carteira entre Renda Fixa e Renda Vari√°vel.", "type": "good", "icon": "üé®", "explanation": "Isso reduz riscos! N√£o colocar todos os ovos na mesma cesta protege seu patrim√¥nio."}', 'medium'),
('consultor', '{"text": "T√≠tulo de Capitaliza√ß√£o oferecido pelo gerente do banco.", "type": "bad", "icon": "üéüÔ∏è", "explanation": "P√©ssimo neg√≥cio! Geralmente rende menos que a poupan√ßa e seu dinheiro fica preso. √â um jogo, n√£o investimento."}', 'medium'),
('consultor', '{"text": "Seguro de Vida para proteger sua fam√≠lia.", "type": "good", "icon": "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", "explanation": "Respons√°vel! Prote√ß√£o financeira para dependentes √© fundamental em um planejamento financeiro s√≥lido."}', 'medium'),
('consultor', '{"text": "Usar a Reserva de Emerg√™ncia para comprar a√ß√µes em queda.", "type": "bad", "icon": "üÜò", "explanation": "Arriscado! A Reserva de Emerg√™ncia deve ficar em liquidez imediata e baixo risco, n√£o em renda vari√°vel."}', 'medium'),
('consultor', '{"text": "Reinvestir os dividendos recebidos.", "type": "good", "icon": "üîÑ", "explanation": "O segredo da riqueza! Reinvestir cria o efeito de juros compostos, acelerando o crescimento do patrim√¥nio."}', 'hard'),
('consultor', '{"text": "Comprar im√≥vel na planta sem verificar a construtora.", "type": "bad", "icon": "üèóÔ∏è", "explanation": "Alto risco! A obra pode atrasar ou a construtora falir. Sempre pesquise o hist√≥rico antes."}', 'hard'),
('consultor', '{"text": "Aumentar os aportes mensais ao receber um aumento de sal√°rio.", "type": "good", "icon": "üìà", "explanation": "Mentalidade correta! Evite inflar seu custo de vida proporcionalmente. Invista a diferen√ßa."}', 'hard'),
('consultor', '{"text": "Pegar empr√©stimo para investir em criptomoedas.", "type": "bad", "icon": "ü™ô", "explanation": "Perigo m√°ximo! Alavancagem em ativos vol√°teis pode te deixar com d√≠vidas impag√°veis se o ativo cair."}', 'hard'),
('consultor', '{"text": "Estudar sobre a empresa antes de comprar suas a√ß√µes.", "type": "good", "icon": "üìñ", "explanation": "Essencial! Investimento requer an√°lise. Comprar \"dicas\" sem entender √© receita para o fracasso."}', 'hard');

-- Seed Data: Desafio de Termos (16 Terms)
INSERT INTO public.game_questions (game_type, content, difficulty) VALUES
('termo', '{"term": "Selic", "definition": "Taxa b√°sica de juros da economia."}', 'easy'),
('termo', '{"term": "Liquidez", "definition": "Facilidade de transformar um ativo em dinheiro."}', 'easy'),
('termo', '{"term": "Dividendo", "definition": "Parte do lucro da empresa distribu√≠da aos acionistas."}', 'easy'),
('termo', '{"term": "IPCA", "definition": "√çndice oficial de infla√ß√£o no Brasil."}', 'easy'),
('termo', '{"term": "CDB", "definition": "Empr√©stimo que voc√™ faz para o banco."}', 'easy'),
('termo', '{"term": "Volatilidade", "definition": "Varia√ß√£o do pre√ßo de um ativo ao longo do tempo."}', 'medium'),
('termo', '{"term": "Day Trade", "definition": "Compra e venda de ativos no mesmo dia."}', 'medium'),
('termo', '{"term": "FGC", "definition": "Garantia de at√© R$ 250 mil em caso de quebra do banco."}', 'medium'),
('termo', '{"term": "IOF", "definition": "Imposto sobre Opera√ß√µes Financeiras."}', 'medium'),
('termo', '{"term": "C√¢mbio", "definition": "Troca de uma moeda por outra (ex: Real por D√≥lar)."}', 'medium'),
('termo', '{"term": "Bear Market", "definition": "Mercado em ten√™ncia de baixa (pessimista)."}', 'hard'),
('termo', '{"term": "Bull Market", "definition": "Mercado em tend√™ncia de alta (otimista)."}', 'hard'),
('termo', '{"term": "PLR", "definition": "Participa√ß√£o nos Lucros e Resultados."}', 'hard'),
('termo', '{"term": "Royalty", "definition": "Pagamento pelo direito de uso de uma propriedade ou marca."}', 'hard'),
('termo', '{"term": "Benchmark", "definition": "√çndice de refer√™ncia para comparar rentabilidade."}', 'hard'),
('termo', '{"term": "Passivo", "definition": "D√≠vidas e obriga√ß√µes financeiras."}', 'hard');

-- Seed Data: Empire Builder (8 Active, 8 Passive items)
INSERT INTO public.empire_items (name, type, base_cost, base_income, description) VALUES
-- Active (Click Multipliers)
('Vender Limonada', 'active', 10, 1, 'Trabalho honesto para come√ßar.'),
('Passear com Cachorros', 'active', 50, 5, 'Exerc√≠cio e dinheiro extra.'),
('Entregar Jornal', 'active', 150, 12, 'Acordar cedo rende frutos.'),
('Freelance Online', 'active', 500, 35, 'Usando suas habilidades digitais.'),
('Dar Aulas Particulares', 'active', 1500, 90, 'Compartilhando conhecimento.'),
('Consultoria Financeira', 'active', 5000, 250, 'Ensinando outros a enriquecer.'),
('Palestrar em Eventos', 'active', 20000, 800, 'Sua autoridade vale muito.'),
('Escrever Best-Seller', 'active', 100000, 3000, 'Royalties de um livro de sucesso.'),

-- Passive (Auto Income)
('Conta Poupan√ßa', 'passive', 100, 2, 'Rendimento baixo, mas √© um come√ßo.'),
('Tesouro Direto', 'passive', 500, 8, 'Empr√©stimo para o governo com seguran√ßa.'),
('Fundo Imobili√°rio (FII)', 'passive', 1500, 25, 'Alugu√©is caindo na conta todo m√™s.'),
('A√ß√µes de Dividendos', 'passive', 5000, 100, 'S√≥cio de grandes empresas.'),
('Empr√©stimo P2P', 'passive', 15000, 250, 'Emprestar para outras pessoas via plataforma.'),
('Im√≥vel de Aluguel', 'passive', 50000, 700, 'Renda passiva cl√°ssica de tijolo.'),
('Franquia Automatizada', 'passive', 200000, 2500, 'Neg√≥cio escal√°vel que roda sozinho.'),
('Shopping Center', 'passive', 1000000, 10000, 'O √°pice do investidor imobili√°rio.');
